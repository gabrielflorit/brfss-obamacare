---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

* * *

## Part 0: Introduction

It's been more than six years since President Obama signed the Affordable Care Act into law. The administration credits Obamacare -- as it is colloquially known -- for lowering the number of uninsured residents: down 11 million since its passage, according to a March 2015 report by the Centers for Disease Control and Prevention.

The uninsured rate varies between states, from 17% in Texas to 5% in Massachusetts, according to the Kaiser Family Foundation. Given this range of uninsured residents, **is there an association between health care coverage and general health-related characteristics?**

We will try to answer this question by looking at the [Behavioral Risk Factor Surveillance System](http://www.cdc.gov/brfss), a yearly telephone survey that collects data on health-related risk behaviors.

* * *

## Part 1: Data

The population of interest is non-institutionalized US residents 18 years or older. To perform the survey, BRFSS researchers use Random Digit Dialing to call thousands of adults -- 506,000 in 2014 -- in all 50 states, DC, and three US territories.

The study might suffer from **coverage bias** because not all US residents own a landline or cellphone. This might mean the study underrepresents hard-to-reach groups.

As an observational study, the BRFSS is conducted by random sampling, which means the survey results can be generalized to the population (if we assume there is no bias and the sample is representative of the population.) Since there is no random assignment, the survey cannot be used to establish causality relationships.

* * *

## Part 2: Research questions

**Research question 1:** Is there an association between health care coverage and general health? In other words, is health insurance associated with better health?

**Research question 2:** Is there an association between health care coverage and not being able to see a doctor because of cost? In other words, if you have insurance, is it more likely that you'll be able to afford a doctor visit? Which states have the highest proportion of insured residents unable to see a doctor due to cost?

**Research question 3:**

* * *

## Part 3: Exploratory data analysis

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(gmodels)
setwd("~/Desktop/week5")
```

### Load data

```{r load-data}
load('brfss2013.RData')
```
* * *
**Research question 1:** Is general health associated to a lack of health care coverage? We can answer this by making a contingency table of general health (*genhlth*) and health care coverage (for respondents aged 18-64 with any form of coverage) (*X_hcvu651*):

```{r}

health_coverage.table <- prop.table(table(brfss2013$genhlth, brfss2013$X_hcvu651), 2)
health_coverage.table

```

The proportions vary within general health, which provides evidence that these two variables are associated. We can also look at a couple graphs - first, a histogram:
```{r}

# Convert to data frame for plotting
health_coverage.data <- as.data.frame(health_coverage.table) %>%
	rename(Health = Var1, Coverage = Var2, Proportion = Freq)

ggplot(health_coverage.data, aes(Health, Proportion, fill=Coverage)) +
	geom_bar(stat='identity', position='dodge') +
	labs(
		title='Distribution of general health by health care coverage',
		subtitle='Respondents are aged 18-64 who have any form of health care coverage'
	)

```

Next, a mosaic-like bar plot:
```{r}

ggplot(health_coverage.data, aes(Coverage, Proportion, fill=Health)) +
	geom_bar(stat='identity') +
	labs(
		title='Distribution of general health by health care coverage',
		subtitle='Respondents are aged 18-64 who have any form of health care coverage'
	)

```

In both these graphs we see that the general health proportions vary by coverage, which provides visual evidence that these two variables are associated.

* * *

**Research question 2:** Is there an association between health care coverage and not being able to see a doctor because of cost? Let's answer this with a contingency table of health care coverage (for respondents aged 18-64 with any form of coverage) (*X_hcvu651*) and not being able to see the doctor due to cost (*medcost*): 

```{r}

prop.table(table(brfss2013$X_hcvu651, brfss2013$medcost), 1)

```

Of those residents with insurance, about 10% say they couldn't see the doctor due to cost. This shows us that the two variables are associated.

* * * 

Next let's look at the states with the highest proportion of insured residents unable to see the doctor due to cost.

```{r}


```

brfss2013 %>%
	select(Coverage = X_hcvu651, Age = X_age80) %>%
	filter(Age > 17, Age < 65) %>%
	na.omit %>%
	group_by(Coverage, Age) %>%
	summarise(n = n()) %>%
  mutate(Proportion = n / sum(n)) %>%
	ggplot(aes(Age, Proportion, color=Coverage)) +
	geom_step()

```

```{r}

prop.table(table(brfss2013$X_hcvu651, brfss2013$medcost), 1)
health_coverage.table

brfss2013 %>%
	select(Coverage = X_hcvu651, Cost = medcost) %>%
	na.omit %>%
	head
	
	filter(Age > 17, Age < 65) %>%
	na.omit %>%
	group_by(Coverage, Age) %>%
	summarise(n = n()) %>%
  mutate(Proportion = n / sum(n)) %>%
	ggplot(aes(Age, Proportion, color=Coverage)) +
	geom_step()

```















